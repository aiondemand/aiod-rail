<header class="topbar" [class.mobile-opened]="mobileOpened()">
  <div class="wrap">
    <!-- LEFT: burger + logo -->
    <div class="left">
      <button
        class="burger"
        type="button"
        (click)="openMobileMenu()"
        aria-label="Open menu"
        [attr.aria-expanded]="mobileOpened()"
        aria-controls="mainNav"
      >
        <mat-icon [fontIcon]="mobileOpened() ? 'close' : 'menu'" aria-hidden="true"></mat-icon>
      </button>

      <a class="logo" href="https://aiod.eu/" aria-label="AiodRail Home">
        <img class="logo-light" src="/assets/logo-color.svg" alt="AiodRail logo" />
        <img class="logo-dark" src="/assets/logo-white.svg" alt="AiodRail logo dark" />
      </a>
    </div>

    <!-- CENTER: navigation -->
    <nav class="nav" id="mainNav">
      <ul class="main" [class.open]="mobileOpened()">
        @for (top of menu(); track top.id; let i = $index) {
        <li
          class="menu"
          [class.align-left]="i === 0 || i === 1"
          [class.align-center]="i === 2 || i === 3"
          [class.align-right]="i === 4 || i === 5"
        >
          <a
            class="menu-link"
            [href]="top.url || '#'"
            [attr.target]="targetFor(top.url)"
            (click)="toggleSubmenuMobile(top, $event)"
          >
            {{ top.title }}
          </a>

          <!-- Desktop hover mega menu -->
          @if (top.children?.length) {
          <div class="mega">
            <ul class="cards">
              @for (c of top.children; track c.id) {
              <li [class.highlight]="c.isHighlighted">
                <a [href]="c.url || '#'" [attr.target]="targetFor(c.url)">
                  <span class="card-title">{{ c.title }}</span>
                  @if (c.description) {
                  <p class="card-desc">{{ c.description }}</p>
                  } @if (c.isHighlighted) {
                  <span class="card-arrow" aria-hidden="true">
                    <mat-icon fontIcon="arrow_forward"></mat-icon>
                  </span>
                  }
                </a>
              </li>
              }
            </ul>

            <!-- Tools footer: Technical Support -->
            @if (isTools(top.title)) {
            <div class="mega-footer">
              <ui-button
                class="tech-support"
                size="lg"
                variant="primary"
                ariaLabel="Open Technical Support"
                (click)="openExternal(external.TECH_SUPPORT)"
              >
                Technical Support
              </ui-button>
            </div>
            }
          </div>
          }

          <!-- Mobile accordion -->
          @if (top.children?.length) {
          <div class="sub" [class.open]="top.open">
            <ul>
              @for (c of top.children; track c.id) {
              <li [class.highlight]="c.isHighlighted">
                <a [href]="c.url || '#'" [attr.target]="targetFor(c.url)">
                  <span>{{ c.title }}</span>
                  @if (c.description) {
                  <p>{{ c.description }}</p>
                  }
                </a>
              </li>
              }
            </ul>
          </div>
          }
        </li>
        }
      </ul>

      <!-- MOBILE ACTIONS (visible only when menu is open) -->
      @if (mobileOpened()) {
      <div class="mobile-actions">
        <ui-button
          class="mobile-search"
          variant="primary"
          size="lg"
          [icon]="true"
          ariaLabel="Search"
          (click)="openExternal(external.MY_LIBRARY)"
        >
          <mat-icon fontIcon="search"></mat-icon>
        </ui-button>

        <ui-button
          class="mobile-get-started"
          size="lg"
          ariaLabel="Get Started"
          (click)="openExternal(external.GET_STARTED)"
        >
          Get Started
        </ui-button>

        <app-login-logout class="mobile-auth"></app-login-logout>

        <theme-switch class="mobile-theme" size="lg" (click)="toggleTheme()"></theme-switch>
      </div>
      }
    </nav>

    <!-- RIGHT: actions (desktop only) -->
    <div class="actions">
      <ui-button
        class="search"
        variant="primary"
        size="lg"
        [icon]="true"
        ariaLabel="Search"
        (click)="openExternal(external.MY_LIBRARY)"
      >
        <mat-icon fontIcon="search"></mat-icon>
      </ui-button>

      <ui-button
        class="get-started"
        size="lg"
        ariaLabel="Get Started"
        (click)="openExternal(external.GET_STARTED)"
      >
        Get Started
      </ui-button>

      <app-login-logout></app-login-logout>

      <theme-switch size="lg" (click)="toggleTheme()"></theme-switch>
    </div>
  </div>
</header>
