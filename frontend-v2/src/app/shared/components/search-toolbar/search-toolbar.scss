@use '../../../../styles/themes';
@use '../../../../styles/typography' as typo;
@use '../../../../variables.scss' as *;

/* =========================
   ROOT / HOST
   ========================= */
:host {
  display: block;
  color: var(--text);
  background: transparent;
}

/* =========================
   TOOLBAR WRAPPER
   ========================= */
.toolbar {
  margin: $margin-double;
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  gap: 12px 16px;
  align-items: center;

  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px;

  @media (max-width: 900px) {
    grid-template-columns: 1fr;
  }
}

/* =========================
   LEFT: SEARCH + FILTERS
   ========================= */
.search {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
  flex: 1 1 auto;

  .input {
    flex: 1 1 auto;
    min-width: 140px;
    height: 40px;
    padding: 0 12px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--background);
    color: var(--text);
    outline: none;

    &::placeholder {
      color: color-mix(in oklab, var(--text) 55%, transparent);
    }
    &:hover {
      border-color: color-mix(in oklab, var(--text) 25%, var(--border));
    }
    &:focus-visible {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary) 25%, transparent);
    }
  }

  .chk {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    border: 1px dashed var(--border);
    border-radius: 10px;
    user-select: none;

    input[type='checkbox'] {
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
      cursor: pointer;
    }

    span {
      font: var(--font-ui, 500 14px/1.2 system-ui, sans-serif);
      white-space: nowrap;
    }
  }
}

/* =========================
   PAGER
   ========================= */
.pager {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  justify-self: end;
  flex-wrap: wrap;
  row-gap: 8px;
  min-width: 0;

  @media (max-width: 900px) {
    justify-self: stretch;
    justify-content: space-between;
  }

  label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font: var(--font-ui, 500 14px/1.2 system-ui, sans-serif);
    color: color-mix(in oklab, var(--text) 85%, transparent);
    min-width: 0;
  }

  .psize {
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .psize-label {
    color: color-mix(in oklab, var(--text) 85%, transparent);
    font: var(--font-ui, 500 14px/1.2 system-ui, sans-serif);
  }

  /* Mat select (trigger) */
  .select.mat-mdc-select {
    height: 36px;
    min-width: 64px;
    width: 75px;
    padding: 0 8px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--background);
    color: var(--text);
    display: inline-flex;
    align-items: center;
    outline: none;

    .mdc-line-ripple,
    .mat-mdc-form-field-underline {
      display: none;
    }

    .mat-mdc-select-trigger {
      width: 100%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .mat-mdc-select-value {
      width: 100%;
      text-align: center;
      font: var(--font-ui, 600 14px/1.2 system-ui, sans-serif);
    }

    .mat-mdc-select-arrow {
      position: absolute;
      right: 8px;
      border-width: 5px 4px 0 4px;
      border-color: color-mix(in oklab, var(--text) 70%, transparent) transparent transparent;
    }

    &:hover {
      border-color: color-mix(in oklab, var(--text) 25%, var(--border));
      cursor: pointer;
    }
    &.mdc-select--focused,
    &:focus-visible {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary) 25%, transparent);
      border-radius: 12px;
    }
  }

  /* Fallback pre natívny <select> */
  .select:not(.mat-mdc-select) {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    height: 36px;
    min-width: 64px;
    width: 75px;
    padding: 0 28px 0 10px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--background);
    color: var(--text);
    font: var(--font-ui, 600 14px/1.2 system-ui, sans-serif);
    cursor: pointer;
    outline: none;

    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 14px;

    &:hover {
      border-color: color-mix(in oklab, var(--text) 25%, var(--border));
    }
    &:focus-visible {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary) 25%, transparent);
    }
  }

  .info {
    min-width: 160px;
    text-align: center;
    font: var(--font-ui, 600 14px/1.2 system-ui, sans-serif);
    color: color-mix(in oklab, var(--text) 90%, transparent);
    padding: 6px 10px;
    border-radius: 10px;
    background: color-mix(in oklab, var(--text) 3%, transparent);
    flex: 0 1 auto;
  }
}

/* =========================
   RESPONSIVE
   ========================= */
@media (max-width: 1100px) {
  .pager {
    justify-content: space-between;

    .psize-label {
      display: none;
    }
    .select.mat-mdc-select,
    .select:not(.mat-mdc-select) {
      width: 75px;
    }

    .info {
      order: 3;
      flex: 1 1 100%;
    }
  }
}
@media (min-width: 900px) and (max-width: 1150px) {
  .toolbar {
    grid-template-columns: 1fr;
  }
  .pager {
    justify-self: stretch;
    justify-content: space-between;
    margin-top: 4px;
    flex-wrap: wrap;
    row-gap: 8px;
  }
}

/* =========================
   MATERIAL OVERRIDES (1:1)
   ========================= */
:host ::ng-deep {
  /* Texty vo fieldoch a option texty */
  .mdc-text-field__input,
  .mat-mdc-select-value,
  .mat-mdc-floating-label,
  .mat-mdc-option .mdc-list-item__primary-text {
    color: var(--text) !important;
  }
  .mdc-text-field__input::placeholder {
    color: color-mix(in oklab, var(--text) 55%, transparent) !important;
  }
  .mdc-text-field__input {
    caret-color: var(--text-active) !important;
  }

  .mat-mdc-select-arrow svg path {
    fill: var(--text) !important;
  }
}

/* =========================
   MAT SELECT OVERLAY – GLOBAL (app-select-panel)
   ========================= */
::ng-deep .cdk-overlay-container .app-select-panel {
  background: var(--card) !important;
  color: var(--text) !important;
  border: 1px solid var(--border) !important;
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option,
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option .mdc-list-item__primary-text {
  color: var(--text) !important;
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option:hover,
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option.mat-mdc-option-active {
  background: color-mix(in oklab, var(--text) 12%, transparent) !important;
  color: var(--text) !important;
}
::ng-deep
  .cdk-overlay-container
  .app-select-panel
  .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple) {
  background: color-mix(in oklab, var(--text) 16%, transparent) !important;
  color: var(--text) !important;
  font-weight: var(--w-medium, 600);
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option.mdc-list-item--disabled {
  color: color-mix(in oklab, var(--text) 45%, transparent) !important;
  opacity: 1;
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option-ripple .mat-ripple-element {
  background-color: color-mix(in oklab, var(--text) 22%, transparent) !important;
}
::ng-deep .cdk-overlay-container .app-select-panel {
  scrollbar-color: color-mix(in oklab, var(--text) 35%, transparent)
    color-mix(in oklab, var(--surface-2) 100%, transparent);
}

/* ======================================
   FIX: MAT-SELECT panel
   ====================================== */
::ng-deep .cdk-overlay-container .pager-select-panel,
::ng-deep .cdk-overlay-container .pager-select-panel.mdc-menu-surface,
::ng-deep .cdk-overlay-container .pager-select-panel.mat-mdc-select-panel {
  background: var(--card) !important;
  color: var(--text) !important;
  border: 1px solid var(--border) !important;
  border-radius: 12px !important;
  box-shadow: 0 14px 32px rgba(0, 0, 0, 0.45) !important;
  opacity: 1 !important; /* Kľúčové – odstráni MDC fade */
  backdrop-filter: none !important;

  --mdc-theme-surface: var(--card) !important;
  --mdc-theme-on-surface: var(--text) !important;
  --mdc-theme-text-primary-on-background: var(--text) !important;
  --mat-select-panel-background-color: var(--card) !important;
  --mdc-menu-container-color: var(--card) !important;

  padding: 6px 0 !important;
  max-height: 320px !important;
  overflow: auto !important;
  z-index: 9999 !important;
}

::ng-deep .cdk-overlay-container .pager-select-panel .mat-mdc-option,
::ng-deep .cdk-overlay-container .pager-select-panel .mat-mdc-option .mdc-list-item__primary-text {
  color: var(--text) !important;
  background: transparent !important;
}

::ng-deep .cdk-overlay-container .pager-select-panel .mat-mdc-option {
  height: 36px !important;
  padding: 0 12px !important;
  margin: 2px 6px !important;
  border-radius: 8px !important;
  font: var(--font-ui, 600 14px/1.2 system-ui, sans-serif) !important;

  &:hover,
  &.mdc-list-item--hover {
    background: color-mix(in oklab, var(--text) 10%, transparent) !important;
  }

  &.mdc-list-item--selected,
  &.mat-mdc-option-active {
    background: color-mix(in oklab, var(--primary) 20%, transparent) !important;
    color: color-mix(in oklab, var(--on-primary, #fff) 95%, var(--text)) !important;
  }

  &.mat-mdc-option-disabled {
    color: color-mix(in oklab, var(--text) 45%, transparent) !important;
    opacity: 0.7 !important;
  }
}

/* Checkmark */
::ng-deep
  .cdk-overlay-container
  .pager-select-panel
  .mat-pseudo-checkbox-checked.mat-pseudo-checkbox-minimal::after {
  color: var(--text) !important;
}

::ng-deep .cdk-overlay-container .mdc-menu-surface--open {
  opacity: 1 !important;
  transition: none !important;
  animation: none !important;
  background-color: var(--card) !important;
}
