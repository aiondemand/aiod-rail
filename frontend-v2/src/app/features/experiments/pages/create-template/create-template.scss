@use '../../../../../styles/typography' as typo;
@use '../../../../../variables.scss' as *;

/* ===== card wrapper  ===== */
.detail.card {
  margin: $margin-double;
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: $margin-double;

  @media (max-width: 760px) {
    margin: $margin-default;
    padding: $margin-default;
  }
}

/* ===== header ===== */
.head .title {
  @include typo.title(--h2-d, --h2-m, --h2-lh-d, --h2-lh-m, --h2-mb-d, --h2-mb-m, --w-bold);
  margin: 0;
}

/* ===== form blocks ===== */
.create-template-form {
  display: grid;
  gap: $margin-default;

  mat-form-field {
    width: 100%;
  }

  .block {
    display: grid;
    gap: 16px;
    padding-top: $margin-default;
    border-top: 1px dashed color-mix(in oklab, var(--text) 14%, transparent);

    h2 {
      @include typo.title(--h4-d, --h4-m, --h4-lh-d, --h4-lh-m, --h4-mb-d, --h4-mb-m, --w-semibold);
    }
    h4 {
      @include typo.title(--h5-d, --h5-m, --h5-lh-d, --h5-lh-m, --h5-mb-d, --h5-mb-m, --w-medium);
      margin: 0;
    }
  }

  .actions {
    display: flex;
    justify-content: flex-start;
  }
}

/* ===== runtime header meta ===== */
.header-with-info {
  display: flex;
  align-items: center;
  gap: 0.25em;
  margin-top: 1em;

  h4 {
    margin-bottom: $margin-default;
  }
  mat-icon {
    color: var(--text-muted);
  }
}

.italic-editor-name {
  text-align: right;
  padding-right: 0.25em;
  margin: 0;
  color: var(--text-muted);
}

/* ===== code editor  ===== */
.code-editor-wrapper {
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 6px;
  background: #1e1e1e;
  min-height: 320px;
  height: clamp(320px, 60vh, 680px);
  overflow: hidden;

  ngs-code-editor,
  ngx-monaco-editor {
    display: block;
    height: 100%;
  }
}

/* ===== ENVs ===== */
.envs .envs-note {
  color: var(--text-muted);
  margin-bottom: 8px;
}

.required-envs h4,
.optional-envs h4 {
  padding-bottom: $margin-default;
}

.add-env-controls {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;

  mat-form-field {
    width: 100%;
    flex: 1 1 0;
    min-width: 240px;
  }
  mat-form-field:first-of-type {
    flex: 1.2 1 0;
  } /* Name */
  mat-form-field:nth-of-type(2) {
    flex: 1.8 1 0;
  } /* Description */

  /* checkbox  */
  mat-checkbox {
    flex: 0 0 auto;
    padding-bottom: $margin-default;
  }
  ui-button {
    flex: 0 0 auto;
    margin-left: auto;
    padding-bottom: $margin-default;
  }

  .empty-space {
    display: none;
  }

  @media (max-width: 900px) {
    mat-form-field {
      flex: 1 1 100%;
      min-width: unset;
    }
    mat-checkbox {
      flex: 0 0 auto;
    }
    ui-button {
      margin-left: auto;
    }
  }
}

.env-table {
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  background: var(--surface-2);
  margin-top: 10px;

  .env-row {
    display: grid;
    grid-template-columns: 1fr 1fr 44px;
    border-bottom: 1px solid var(--border);

    &:last-child {
      border-bottom: 0;
    }

    &--head {
      background: color-mix(in oklab, var(--text) 7%, transparent);
      .c {
        font-weight: var(--w-semibold);
        color: var(--text);
      }
    }

    .c {
      padding: 12px 14px;
      display: flex;
      align-items: center;
      min-width: 0;

      &.k .env-name {
        display: inline-flex;
        align-items: center;
        gap: 8px;

        .secret {
          font-size: 18px;
          color: var(--text-muted);
          opacity: 0.9;
          position: relative;
          top: 2px;
        }
      }

      &.v {
        color: var(--text);
        word-break: break-word;
      }

      &.act {
        justify-content: center;
        align-items: center;
      }
    }
  }

  @media (max-width: 640px) {
    .env-row {
      grid-template-columns: 1fr;
    }
    .env-row .c.act {
      justify-content: flex-start;
      padding-top: 0;
    }
  }
}

.icon-btn {
  box-sizing: border-box;
  width: 32px;
  height: 32px;
  padding-inline: 5px;
  border: 1px solid var(--border);
  background: color-mix(in oklab, var(--text) 8%, transparent);
  color: var(--text);
  border-radius: 10px;
  cursor: pointer;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  &:hover {
    background: color-mix(in oklab, var(--text) 14%, transparent);
  }

  .mat-icon,
  .material-symbols-rounded {
    font-size: 20px;
    line-height: 1;
    width: 1em;
    height: 1em;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
}

.note {
  margin-top: 8px;
  color: var(--text-muted);
  font-size: 12.5px;
  font-family: var(--font-body);
}

.upper-margin {
  margin-top: 1.1rem;
}

/* ===== MATERIAL  ===== */
:host ::ng-deep {
  .mdc-text-field__input,
  .mat-mdc-select-value,
  .mat-mdc-floating-label,
  .mat-mdc-option .mdc-list-item__primary-text {
    color: var(--text) !important;
  }
  .mdc-text-field__input::placeholder {
    color: color-mix(in oklab, var(--text) 55%, transparent) !important;
  }
  .mdc-text-field__input {
    caret-color: var(--text-active) !important;
  }

  .mdc-notched-outline__leading,
  .mdc-notched-outline__notch,
  .mdc-notched-outline__trailing {
    border-color: color-mix(in oklab, var(--text) 22%, var(--border)) !important;
  }
  .mdc-text-field--focused .mdc-notched-outline__leading,
  .mdc-text-field--focused .mdc-notched-outline__notch,
  .mdc-text-field--focused .mdc-notched-outline__trailing {
    border-color: var(--text-active) !important;
  }

  .mdc-floating-label {
    color: color-mix(in oklab, var(--text) 80%, transparent) !important;
  }
  .mdc-floating-label--float-above {
    color: color-mix(in oklab, var(--text) 85%, transparent) !important;
  }
  .mat-mdc-form-field-hint-wrapper,
  .mat-mdc-form-field-error {
    color: color-mix(in oklab, var(--text) 85%, transparent) !important;
  }

  .mat-mdc-select-arrow svg path {
    fill: var(--text) !important;
  }

  .cdk-overlay-pane .mat-mdc-select-panel,
  .app-select-panel {
    background: var(--card) !important;
    color: var(--text) !important;
    border: 1px solid var(--border) !important;
    box-shadow: 0 14px 32px color-mix(in oklab, var(--shadow) 40%, transparent) !important;
  }

  .mat-mdc-option {
    color: var(--text) !important;
  }
  .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple),
  .mat-mdc-option.mdc-list-item:hover {
    background: color-mix(in oklab, var(--text) 10%, transparent) !important;
  }

  .mat-mdc-form-field-focus-overlay {
    background: transparent !important;
  }
  .mdc-text-field__input:focus,
  textarea.mdc-text-field__input:focus {
    outline: none !important;
    box-shadow: none !important;
  }

  /* Checkbox label  */
  .mdc-label,
  .mat-mdc-checkbox .mdc-label {
    color: var(--text) !important;
  }
}

/* === MAT SELECT overlay  === */
::ng-deep .cdk-overlay-container .app-select-panel {
  background: var(--card) !important;
  color: var(--text) !important;
  border: 1px solid var(--border) !important;
  box-shadow: 0 14px 32px color-mix(in oklab, var(--shadow) 40%, transparent) !important;
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option,
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option .mdc-list-item__primary-text {
  color: var(--text) !important;
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option:hover,
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option.mat-mdc-option-active {
  background: color-mix(in oklab, var(--text) 12%, transparent) !important;
  color: var(--text) !important;
}
::ng-deep
  .cdk-overlay-container
  .app-select-panel
  .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple) {
  background: color-mix(in oklab, var(--text) 16%, transparent) !important;
  color: var(--text) !important;
  font-weight: var(--w-medium, 600);
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option.mdc-list-item--disabled {
  color: color-mix(in oklab, var(--text) 45%, transparent) !important;
  opacity: 1;
}
::ng-deep .cdk-overlay-container .app-select-panel .mat-mdc-option-ripple .mat-ripple-element {
  background-color: color-mix(in oklab, var(--text) 22%, transparent) !important;
}
::ng-deep .cdk-overlay-container .app-select-panel {
  scrollbar-color: color-mix(in oklab, var(--text) 35%, transparent)
    color-mix(in oklab, var(--surface-2) 100%, transparent);
}

:root {
  --mat-option-label-text-color: var(--text);
}

::ng-deep
  .cdk-overlay-container
  .app-select-panel
  .mat-pseudo-checkbox-checked.mat-pseudo-checkbox-minimal::after {
  color: var(--text);
}

:host ::ng-deep .mat-mdc-checkbox {
  .mdc-checkbox__background {
    border: 2px solid color-mix(in oklab, var(--text) 45%, transparent) !important;
    box-shadow: none !important;
  }

  .mdc-checkbox:hover .mdc-checkbox__background {
    border-color: var(--accent) !important;
    box-shadow: none !important;
  }

  .mdc-checkbox__native-control:enabled:checked ~ .mdc-checkbox__background {
    border-color: transparent !important;
    box-shadow: none !important;
  }
}
