<header class="topbar" [class.mobile-opened]="mobileOpened()">
  <div class="wrap">
    <!-- LEFT: burger + logo -->
    <div class="left">
      <button
        class="burger"
        type="button"
        (click)="openMobileMenu()"
        aria-label="Open menu"
        [attr.aria-expanded]="mobileOpened()"
      >
        <mat-icon fontIcon="menu" aria-hidden="true"></mat-icon>
      </button>

      <a class="logo" href="https://aiod.eu/" aria-label="AiodRail Home">
        <img class="logo-light" src="/assets/logo-color.svg" alt="AiodRail logo" />
        <img class="logo-dark" src="/assets/logo-white.svg" alt="AiodRail logo dark" />
      </a>
    </div>

    <!-- CENTER: navigation -->
    <nav class="nav">
      <ul class="main" [class.open]="mobileOpened()">
        <li
          class="menu"
          *ngFor="let top of menu(); let i = index"
          [class.align-left]="i === 0 || i === 1"
          [class.align-center]="i === 2 || i === 3"
          [class.align-right]="i === 4 || i === 5"
        >
          <a
            class="menu-link"
            [href]="top.url || '#'"
            [attr.target]="targetFor(top.url)"
            (click)="toggleSubmenuMobile(top, $event)"
          >
            {{ top.title }}
          </a>

          <!-- Desktop hover mega menu -->
          <div class="mega" *ngIf="top.children?.length">
            <ul class="cards">
              <li *ngFor="let c of top.children" [class.highlight]="c.isHighlighted">
                <a [href]="c.url || '#'" [attr.target]="targetFor(c.url)">
                  <span class="card-title">{{ c.title }}</span>
                  <p class="card-desc" *ngIf="c.description">{{ c.description }}</p>

                  <!-- yellow arrow bubble only for highlighted cards -->
                  <span class="card-arrow" *ngIf="c.isHighlighted" aria-hidden="true">
                    <mat-icon fontIcon="arrow_forward"></mat-icon>
                  </span>
                </a>
              </li>
            </ul>

            <!-- Tools footer: Technical Support button -->
            <div class="mega-footer" *ngIf="isTools(top.title)">
              <ui-button
                class="tech-support"
                size="lg"
                variant="primary"
                ariaLabel="Open Technical Support"
                (click)="openExternal(external.TECH_SUPPORT)"
              >
                Technical Support
              </ui-button>
            </div>
          </div>

          <!-- Mobile accordion -->
          <div class="sub" *ngIf="top.children?.length" [class.open]="top.open">
            <ul>
              <li *ngFor="let c of top.children" [class.highlight]="c.isHighlighted">
                <a [href]="c.url || '#'" [attr.target]="targetFor(c.url)">
                  <span>{{ c.title }}</span>
                  <p *ngIf="c.description">{{ c.description }}</p>
                </a>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </nav>

    <!-- RIGHT: actions -->
    <div class="actions">
      <ui-button
        class="search"
        variant="primary"
        size="lg"
        [icon]="true"
        ariaLabel="Search"
        (click)="openExternal(external.MY_LIBRARY)"
      >
        <mat-icon fontIcon="search"></mat-icon>
      </ui-button>

      <ui-button
        class="get-started"
        size="lg"
        ariaLabel="Get Started"
        (click)="openExternal(external.GET_STARTED)"
      >
        Get Started
      </ui-button>

      <app-login-logout></app-login-logout>

      <theme-switch size="lg" (click)="toggleTheme()"></theme-switch>
    </div>
  </div>
</header>
